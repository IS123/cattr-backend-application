<div class="statistics" (click)="clickPopover.hide()">
    <div class="statistics__buttons btn-group" role="group">
        <button type="button" (click)="exportCSV()" class="btn btn-default" translate>control.export-csv</button>
    </div>

    <div class="statistics__header">
        <app-date-range-selector (modeChanged)="setMode($event)" #dateRangeSelector>
            <div class="timezone">
                <ng2-timezone-picker
                    [(timezone)]="timezone"
                    showOffset="true"
                    placeholder="Select timezone"
                    guess="true">
                </ng2-timezone-picker>
            </div>

            <app-user-selector class="statistics__users" #userSelect after
                [filter]="userFilter">
            </app-user-selector>
        </app-date-range-selector>
    </div>

    <div class="statistics__timeline">
        <ngx-loading [show]="loading"></ngx-loading>
        <span #clickPopover="bs-popover" id="clickPopover"
            [popover]="clickPopoverTemplate"
            (onHidden)="setSelectedIntervals([])"></span>
        <span #hoverPopover="bs-popover" id="hoverPopover"
            [outsideClick]="true" [popover]="hoverPopoverTemplate"></span>
        <p-schedule #timeline [header]="false" [options]="timelineOptions"></p-schedule>
    </div>
</div>

<ng-template #clickPopoverTemplate>
    <div class="statistics-popover statistics-popover_click">
        <p class="statistics-popover__line">
            <ngx-loading [show]="popoverLoading"></ngx-loading>
            <a *ngIf="clickPopoverScreenshot !== null"
                [routerLink]="['/screenshots/show', clickPopoverScreenshot.id]">
                <app-image class="statistics-popover__image"
                    [src]="clickPopoverScreenshot.thumbnail_path ? clickPopoverScreenshot.thumbnail_path : (clickPopoverScreenshot.path ? clickPopoverScreenshot.path : 'uploads/none.png')">
                </app-image>
            </a>
        </p>

        <p class="statistics-popover__line">
            <a *ngIf="clickPopoverTask !== null" class="statistics-popover__link"
                [routerLink]="['/tasks/show', clickPopoverTask.id]">{{ clickPopoverText }}</a>
        </p>
    </div>
</ng-template>

<ng-template #hoverPopoverTemplate>
    <div class="statistics-popover statistics-popover_hover">
        <p class="statistics-popover__line" [innerHTML]="hoverPopoverText"></p>
    </div>
</ng-template>
